---
title: "Citibike"
output: html_document
---

```{r}

library(readr)
library(dplyr)

citibike <- read_csv("201606-citibike-tripdata.csv")



```

```{r}
citibike_variables <- names(citibike)
citibike_variables
```

Cleaned variable names for citibike
```{r}

citibike_clean <- rename(citibike, start_station_id = `start station id`,
                               start_station_name = `start station name`,
                               start_station_latitude = `start station latitude`,
                               start_station_longitude = `start station longitude`,
                               end_station_id = `end station id`,
                               end_station_name = `end station name`,
                               end_station_latitude = `end station latitude`,
                               end_station_longitude =`end station longitude`,
                               birth_year = `birth year`)

```


Let's fix some of the datatypes for our variables.
Station IDs and Bike IDs should be character type because they are identifers they don't hold integral values.

```{r}
# Station IDs
citibike_clean$start_station_id <- as.character(citibike_clean$start_station_id)
citibike_clean$end_station_id <- as.character(citibike_clean$end_station_id)

# Bike IDs
citibike_clean$bikeid <- as.character(citibike_clean$bikeid)

#Let's change the birth year to a character date
citibike_clean$birth_year <-  as.character.Date(citibike_clean$birth_year)


```

We also need to separte starttime and stopttime into date and time

```{r}

#starttime
citibike_clean$startdate <- as.character.Date(sapply(citibike_clean$starttime, function(x) strsplit(x, " ")[[1]][1]))

citibike_clean$starttime <- as.character.Date(sapply(citibike_clean$starttime, function(x) strsplit(x, " ")[[1]][2]))

#stoptime
citibike_clean$stopdate <- as.character.Date(sapply(citibike_clean$stoptime, function(x) strsplit(x, " ")[[1]][1]))

citibike_clean$stoptime <- as.character.Date(sapply(citibike_clean$stoptime, function(x) strsplit(x, " ")[[1]][2]))
```



Get all the unique stations in our data

```{r}

start_stations <- citibike_clean %>%
  select(start_station_id, start_station_longitude, start_station_latitude) %>% 
  unique()

end_stations <- citibike_clean %>% 
  select(end_station_id, end_station_longitude, end_station_latitude) %>% 
  unique()

```


Now let's map these stations. To create a map, we load the libary 'maps' and plot the min./max latitude and min/max longitutde.
**IMPORTANT** 
Longitude data is the x-axis
Latitude data is the y-axis
```{r}
library(ggmap)

#We are giving the map 1 standard deviation bigger than the ends of the locations
long_min <- min(start_stations$start_station_longitude)
long_max <-  max(start_stations$start_station_longitude)

lat_min <- min(start_stations$start_station_latitude)
lat_max <- min(start_stations$start_station_latitude)

```

```{r}

station_map <- qmplot(start_station_longitude,
                      start_station_latitude,
                      data = start_stations,
                      maptype = "toner-lite",
                      color = I("red"))

station_map
```


Now let's see where most riders are located

```{r}

qmplot(start_station_longitude,
                    start_station_latitude,
                    data = citibike_clean,
                    maptype = "toner-lite",
                    darken = .3) +
  stat_density2d(aes(fill = ..level..),
                 geom = "polygon",
                 alpha = .3,
                 color = NA) +
  scale_fill_gradient2("Rider\nPropensity",
                       low = "white",
                       mid = "yellow",
                       high = "red"
                       )

```

